<!DOCTYPE html>
<html lang="en"><head>

  <!-- Load KaTeX (Latest Version) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css" integrity="sha512-ZqiWzpHm6oG3MiQg5P8tGgNNTNtrMTzgfqlZXCPWZ6f7QVjm4n7xF0WGI3WgJLnxXh+HjRwu8d6Y3EAgv+WZBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.js" integrity="sha512-LqAYXyJAmwp8k1jdxNF3rD1Hl7l3YdL+TNkxbgOFON5hYgGcx5Kj2JckKTcSKF3yN6HhSPWzfnvfwLcf9n5XCw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <!-- KaTeX Auto-render for automatic math rendering -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/contrib/auto-render.min.js" integrity="sha512-iWiuBS5nt6r60fCz26Nd0Zqe0nbk1ZTIQbl3Kv7kYsX+yKMUFHzjaH2+AnM6vp2Xs+gNmaBAVWJjSmuPw76Efg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <!-- Highlight.js for modern syntax highlighting -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css" id="highlight-light">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css" id="highlight-dark" disabled>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <!-- Additional language support -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/lisp.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/lua.min.js"></script>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <!-- Preload Inter for body text and JetBrains Mono for code -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;450;500;600&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Testing Modern Syntax Highlighting | Robbie’s Blog - Review Site</title>
<meta name="generator" content="Jekyll v3.9.5" />
<meta property="og:title" content="Testing Modern Syntax Highlighting" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Modern Code Block Testing" />
<meta property="og:description" content="Modern Code Block Testing" />
<link rel="canonical" href="https://review.rob-blog.co.uk/testing/2025/01/21/testing-new-syntax-highlighting.html" />
<meta property="og:url" content="https://review.rob-blog.co.uk/testing/2025/01/21/testing-new-syntax-highlighting.html" />
<meta property="og:site_name" content="Robbie’s Blog - Review Site" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2025-01-21T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Testing Modern Syntax Highlighting" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2025-01-21T00:00:00+00:00","datePublished":"2025-01-21T00:00:00+00:00","description":"Modern Code Block Testing","headline":"Testing Modern Syntax Highlighting","mainEntityOfPage":{"@type":"WebPage","@id":"https://review.rob-blog.co.uk/testing/2025/01/21/testing-new-syntax-highlighting.html"},"url":"https://review.rob-blog.co.uk/testing/2025/01/21/testing-new-syntax-highlighting.html"}</script>
<!-- End Jekyll SEO tag -->
<!-- Load Minima Styles -->
  <link rel="stylesheet" href="/assets/main.css">

  <!-- Load Custom Styles (Overrides Minima) -->
  <link rel="stylesheet" href="/assets/css/custom.css">
  
  <!-- Review Site Password Protection -->
  <script src="/assets/js/review-protection.js"></script>
  
  <!-- Prevent theme flicker by setting theme immediately -->
  <script>
    (function() {
      function getStoredTheme() {
        return localStorage.getItem('theme');
      }
      
      function getSystemTheme() {
        return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
      }
      
      function getCurrentTheme() {
        return getStoredTheme() || getSystemTheme();
      }
      
      // Apply theme immediately to prevent flicker
      document.documentElement.setAttribute('data-theme', getCurrentTheme());
    })();
  </script><link type="application/atom+xml" rel="alternate" href="https://review.rob-blog.co.uk/feed.xml" title="Robbie's Blog - Review Site" /></head>
<body><header class="site-header" role="banner">
  <div class="wrapper"><a class="site-title" rel="author" href="/">Robbie&#39;s Blog - Review Site</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a><input type="text" id="search-input" placeholder="Search posts..." class="search-input" style="display: none;">
          <button class="search-toggle" id="search-toggle" aria-label="Toggle search">
            <span class="search-icon">Search</span>
          </button>
          <button class="theme-toggle" id="theme-toggle" aria-label="Toggle dark mode">
            <span class="theme-icon">Dark</span>
          </button>
        </div>
      </nav><link rel="stylesheet" href="/assets/css/custom.css">
  </div>
</header>

<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>
<article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Testing Modern Syntax Highlighting</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2025-01-21T00:00:00+00:00" itemprop="datePublished">Jan 21, 2025
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <h1 id="modern-code-block-testing">Modern Code Block Testing</h1>

<p>Testing the new Prism.js syntax highlighting with your preferred languages:</p>

<h2 id="c-example">C++ Example</h2>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;memory&gt;</span><span class="cp">
</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
<span class="k">class</span> <span class="nc">TensorBuffer</span> <span class="p">{</span>
<span class="nl">private:</span>
    <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">T</span><span class="p">[]</span><span class="o">&gt;</span> <span class="n">data_</span><span class="p">;</span>
    <span class="kt">size_t</span> <span class="n">size_</span><span class="p">;</span>

<span class="nl">public:</span>
    <span class="n">TensorBuffer</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">size</span><span class="p">)</span> <span class="o">:</span> <span class="n">size_</span><span class="p">(</span><span class="n">size</span><span class="p">),</span> <span class="n">data_</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">T</span><span class="p">[]</span><span class="o">&gt;</span><span class="p">(</span><span class="n">size</span><span class="p">))</span> <span class="p">{}</span>
    
    <span class="n">T</span><span class="o">&amp;</span> <span class="k">operator</span><span class="p">[](</span><span class="kt">size_t</span> <span class="n">index</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">index</span> <span class="o">&gt;=</span> <span class="n">size_</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">out_of_range</span><span class="p">(</span><span class="s">"Index out of bounds"</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">data_</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
    <span class="p">}</span>
    
    <span class="kt">void</span> <span class="n">fill</span><span class="p">(</span><span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">value</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">size_</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">data_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">TensorBuffer</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">buffer</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
    <span class="n">buffer</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span><span class="mf">0.0</span><span class="n">f</span><span class="p">);</span>
    
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Buffer created with size: "</span> <span class="o">&lt;&lt;</span> <span class="n">buffer</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="python-example">Python Example</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>

<span class="k">class</span> <span class="nc">FiniteVolumeMethod</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grid_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">boundary_conditions</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">grid_size</span> <span class="o">=</span> <span class="n">grid_size</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">boundary_conditions</span> <span class="o">=</span> <span class="n">boundary_conditions</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">solution</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">grid_size</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">solve_poisson</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_term</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">ndarray</span><span class="p">,</span> 
                     <span class="n">tolerance</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-6</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="p">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="s">"""
        Solve Poisson equation using finite volume method
        ∇²φ = f
        """</span>
        <span class="n">max_iterations</span> <span class="o">=</span> <span class="mi">10000</span>
        
        <span class="k">for</span> <span class="n">iteration</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_iterations</span><span class="p">):</span>
            <span class="n">old_solution</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">solution</span><span class="p">.</span><span class="n">copy</span><span class="p">()</span>
            
            <span class="c1"># Interior points
</span>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">grid_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">solution</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="p">.</span><span class="n">solution</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="p">.</span><span class="n">solution</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">source_term</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="p">)</span>
            
            <span class="c1"># Apply boundary conditions
</span>            <span class="bp">self</span><span class="p">.</span><span class="n">_apply_boundaries</span><span class="p">()</span>
            
            <span class="c1"># Check convergence
</span>            <span class="n">residual</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nb">max</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">solution</span> <span class="o">-</span> <span class="n">old_solution</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">residual</span> <span class="o">&lt;</span> <span class="n">tolerance</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Converged in </span><span class="si">{</span><span class="n">iteration</span><span class="si">}</span><span class="s"> iterations"</span><span class="p">)</span>
                <span class="k">break</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">solution</span>
    
    <span class="k">def</span> <span class="nf">_apply_boundaries</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""Apply Dirichlet boundary conditions"""</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">solution</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">boundary_conditions</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'left'</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">solution</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">boundary_conditions</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'right'</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="rust-example">Rust Example</h2>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">fmt</span><span class="p">::</span><span class="n">Display</span><span class="p">;</span>

<span class="k">trait</span> <span class="n">ComputeBackend</span> <span class="p">{</span>
    <span class="k">type</span> <span class="n">Buffer</span><span class="p">;</span>
    <span class="k">type</span> <span class="n">Error</span><span class="p">;</span>
    
    <span class="k">fn</span> <span class="nf">allocate_buffer</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">usize</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Result</span><span class="o">&lt;</span><span class="k">Self</span><span class="p">::</span><span class="n">Buffer</span><span class="p">,</span> <span class="k">Self</span><span class="p">::</span><span class="n">Error</span><span class="o">&gt;</span><span class="p">;</span>
    <span class="k">fn</span> <span class="nf">copy_to_device</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="o">&amp;</span><span class="p">[</span><span class="nb">f32</span><span class="p">],</span> <span class="n">buffer</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="k">Self</span><span class="p">::</span><span class="n">Buffer</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Result</span><span class="o">&lt;</span><span class="p">(),</span> <span class="k">Self</span><span class="p">::</span><span class="n">Error</span><span class="o">&gt;</span><span class="p">;</span>
    <span class="k">fn</span> <span class="nf">execute_kernel</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">kernel_name</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">,</span> <span class="n">buffer</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">Self</span><span class="p">::</span><span class="n">Buffer</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Result</span><span class="o">&lt;</span><span class="p">(),</span> <span class="k">Self</span><span class="p">::</span><span class="n">Error</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">}</span>

<span class="nd">#[derive(Debug)]</span>
<span class="k">pub</span> <span class="k">struct</span> <span class="n">MetalBackend</span> <span class="p">{</span>
    <span class="n">device</span><span class="p">:</span> <span class="nn">metal</span><span class="p">::</span><span class="n">Device</span><span class="p">,</span>
    <span class="n">command_queue</span><span class="p">:</span> <span class="nn">metal</span><span class="p">::</span><span class="n">CommandQueue</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">impl</span> <span class="n">MetalBackend</span> <span class="p">{</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">new</span><span class="p">()</span> <span class="k">-&gt;</span> <span class="nb">Result</span><span class="o">&lt;</span><span class="k">Self</span><span class="p">,</span> <span class="nb">Box</span><span class="o">&lt;</span><span class="k">dyn</span> <span class="nn">std</span><span class="p">::</span><span class="nn">error</span><span class="p">::</span><span class="n">Error</span><span class="o">&gt;&gt;</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">device</span> <span class="o">=</span> <span class="nn">metal</span><span class="p">::</span><span class="nn">Device</span><span class="p">::</span><span class="nf">system_default</span><span class="p">()</span>
            <span class="nf">.ok_or</span><span class="p">(</span><span class="s">"No Metal device found"</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
        
        <span class="k">let</span> <span class="n">command_queue</span> <span class="o">=</span> <span class="n">device</span><span class="nf">.new_command_queue</span><span class="p">();</span>
        
        <span class="nf">Ok</span><span class="p">(</span><span class="n">MetalBackend</span> <span class="p">{</span> <span class="n">device</span><span class="p">,</span> <span class="n">command_queue</span> <span class="p">})</span>
    <span class="p">}</span>
    
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">create_compute_pipeline</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Result</span><span class="o">&lt;</span><span class="nn">metal</span><span class="p">::</span><span class="n">ComputePipelineState</span><span class="p">,</span> <span class="nb">Box</span><span class="o">&lt;</span><span class="k">dyn</span> <span class="nn">std</span><span class="p">::</span><span class="nn">error</span><span class="p">::</span><span class="n">Error</span><span class="o">&gt;&gt;</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">library</span> <span class="o">=</span> <span class="k">self</span><span class="py">.device</span><span class="nf">.new_library_with_source</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="o">&amp;</span><span class="nn">metal</span><span class="p">::</span><span class="nn">CompileOptions</span><span class="p">::</span><span class="nf">new</span><span class="p">())</span><span class="o">?</span><span class="p">;</span>
        <span class="k">let</span> <span class="n">function</span> <span class="o">=</span> <span class="n">library</span><span class="nf">.get_function</span><span class="p">(</span><span class="s">"saxpy"</span><span class="p">,</span> <span class="nb">None</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
        
        <span class="nf">Ok</span><span class="p">(</span><span class="k">self</span><span class="py">.device</span><span class="nf">.new_compute_pipeline_state_with_function</span><span class="p">(</span><span class="o">&amp;</span><span class="n">function</span><span class="p">)</span><span class="o">?</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="k">-&gt;</span> <span class="nb">Result</span><span class="o">&lt;</span><span class="p">(),</span> <span class="nb">Box</span><span class="o">&lt;</span><span class="k">dyn</span> <span class="nn">std</span><span class="p">::</span><span class="nn">error</span><span class="p">::</span><span class="n">Error</span><span class="o">&gt;&gt;</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">backend</span> <span class="o">=</span> <span class="nn">MetalBackend</span><span class="p">::</span><span class="nf">new</span><span class="p">()</span><span class="o">?</span><span class="p">;</span>
    <span class="nd">println!</span><span class="p">(</span><span class="s">"Metal backend initialized successfully"</span><span class="p">);</span>
    <span class="nf">Ok</span><span class="p">(())</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="common-lisp-example">Common Lisp Example</h2>

<div class="language-lisp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nb">defpackage</span> <span class="ss">:tensor-lib</span>
  <span class="p">(</span><span class="ss">:use</span> <span class="ss">:cl</span><span class="p">)</span>
  <span class="p">(</span><span class="ss">:export</span> <span class="ss">#:tensor</span> <span class="ss">#:make-tensor</span> <span class="ss">#:tensor-ref</span> <span class="ss">#:tensor-dimensions</span>
           <span class="ss">#:matrix-multiply</span> <span class="ss">#:element-wise-add</span><span class="p">))</span>

<span class="p">(</span><span class="nb">in-package</span> <span class="ss">:tensor-lib</span><span class="p">)</span>

<span class="p">(</span><span class="nb">defclass</span> <span class="nv">tensor</span> <span class="p">()</span>
  <span class="p">((</span><span class="nv">data</span> <span class="ss">:initarg</span> <span class="ss">:data</span> <span class="ss">:accessor</span> <span class="nv">tensor-data</span><span class="p">)</span>
   <span class="p">(</span><span class="nv">dimensions</span> <span class="ss">:initarg</span> <span class="ss">:dimensions</span> <span class="ss">:accessor</span> <span class="nv">tensor-dimensions</span><span class="p">)</span>
   <span class="p">(</span><span class="nv">backend</span> <span class="ss">:initarg</span> <span class="ss">:backend</span> <span class="ss">:accessor</span> <span class="nv">tensor-backend</span> <span class="ss">:initform</span> <span class="ss">:cpu</span><span class="p">)))</span>

<span class="p">(</span><span class="nb">defmethod</span> <span class="nv">make-tensor</span> <span class="p">(</span><span class="nv">dimensions</span> <span class="k">&amp;key</span> <span class="p">(</span><span class="nv">initial-value</span> <span class="mf">0.0</span><span class="p">)</span> <span class="p">(</span><span class="nv">backend</span> <span class="ss">:cpu</span><span class="p">))</span>
  <span class="s">"Create a new tensor with given dimensions"</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">total-size</span> <span class="p">(</span><span class="nb">reduce</span> <span class="nf">#'</span><span class="nb">*</span> <span class="nv">dimensions</span><span class="p">)))</span>
    <span class="p">(</span><span class="nb">make-instance</span> <span class="ss">'tensor</span>
                   <span class="ss">:data</span> <span class="p">(</span><span class="nb">make-array</span> <span class="nv">total-size</span> <span class="ss">:initial-element</span> <span class="nv">initial-value</span>
                                   <span class="ss">:element-type</span> <span class="ss">'single-float</span><span class="p">)</span>
                   <span class="ss">:dimensions</span> <span class="nv">dimensions</span>
                   <span class="ss">:backend</span> <span class="nv">backend</span><span class="p">)))</span>

<span class="p">(</span><span class="nb">defmethod</span> <span class="nv">tensor-ref</span> <span class="p">((</span><span class="nv">tensor</span> <span class="nv">tensor</span><span class="p">)</span> <span class="k">&amp;rest</span> <span class="nv">indices</span><span class="p">)</span>
  <span class="s">"Reference a tensor element by indices"</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">flat-index</span> <span class="p">(</span><span class="nv">compute-flat-index</span> <span class="nv">indices</span> <span class="p">(</span><span class="nv">tensor-dimensions</span> <span class="nv">tensor</span><span class="p">))))</span>
    <span class="p">(</span><span class="nb">aref</span> <span class="p">(</span><span class="nv">tensor-data</span> <span class="nv">tensor</span><span class="p">)</span> <span class="nv">flat-index</span><span class="p">)))</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">compute-flat-index</span> <span class="p">(</span><span class="nv">indices</span> <span class="nv">dimensions</span><span class="p">)</span>
  <span class="s">"Convert multi-dimensional indices to flat array index"</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">index</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">(</span><span class="nv">multiplier</span> <span class="mi">1</span><span class="p">))</span>
    <span class="p">(</span><span class="nb">loop</span> <span class="nv">for</span> <span class="nv">i</span> <span class="nv">from</span> <span class="p">(</span><span class="nb">1-</span> <span class="p">(</span><span class="nb">length</span> <span class="nv">indices</span><span class="p">))</span> <span class="nv">downto</span> <span class="mi">0</span>
          <span class="nv">for</span> <span class="nv">dim-i</span> <span class="nv">from</span> <span class="p">(</span><span class="nb">1-</span> <span class="p">(</span><span class="nb">length</span> <span class="nv">dimensions</span><span class="p">))</span> <span class="nv">downto</span> <span class="mi">0</span>
          <span class="nb">do</span> <span class="p">(</span><span class="nb">incf</span> <span class="nv">index</span> <span class="p">(</span><span class="nb">*</span> <span class="p">(</span><span class="nb">nth</span> <span class="nv">i</span> <span class="nv">indices</span><span class="p">)</span> <span class="nv">multiplier</span><span class="p">))</span>
             <span class="p">(</span><span class="nb">setf</span> <span class="nv">multiplier</span> <span class="p">(</span><span class="nb">*</span> <span class="nv">multiplier</span> <span class="p">(</span><span class="nb">nth</span> <span class="nv">dim-i</span> <span class="nv">dimensions</span><span class="p">))))</span>
    <span class="nv">index</span><span class="p">))</span>

<span class="p">(</span><span class="nb">defmethod</span> <span class="nv">matrix-multiply</span> <span class="p">((</span><span class="nv">a</span> <span class="nv">tensor</span><span class="p">)</span> <span class="p">(</span><span class="nv">b</span> <span class="nv">tensor</span><span class="p">))</span>
  <span class="s">"Multiply two 2D tensors (matrices)"</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">a-dims</span> <span class="p">(</span><span class="nv">tensor-dimensions</span> <span class="nv">a</span><span class="p">))</span>
        <span class="p">(</span><span class="nv">b-dims</span> <span class="p">(</span><span class="nv">tensor-dimensions</span> <span class="nv">b</span><span class="p">)))</span>
    <span class="p">(</span><span class="nb">assert</span> <span class="p">(</span><span class="nb">=</span> <span class="p">(</span><span class="nb">second</span> <span class="nv">a-dims</span><span class="p">)</span> <span class="p">(</span><span class="nb">first</span> <span class="nv">b-dims</span><span class="p">))</span> <span class="p">()</span>
            <span class="s">"Matrix dimensions incompatible for multiplication"</span><span class="p">)</span>
    
    <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">result</span> <span class="p">(</span><span class="nv">make-tensor</span> <span class="p">(</span><span class="nb">list</span> <span class="p">(</span><span class="nb">first</span> <span class="nv">a-dims</span><span class="p">)</span> <span class="p">(</span><span class="nb">second</span> <span class="nv">b-dims</span><span class="p">)))))</span>
      <span class="p">(</span><span class="nb">loop</span> <span class="nv">for</span> <span class="nv">i</span> <span class="nv">from</span> <span class="mi">0</span> <span class="nv">below</span> <span class="p">(</span><span class="nb">first</span> <span class="nv">a-dims</span><span class="p">)</span>
            <span class="nb">do</span> <span class="p">(</span><span class="nb">loop</span> <span class="nv">for</span> <span class="nv">j</span> <span class="nv">from</span> <span class="mi">0</span> <span class="nv">below</span> <span class="p">(</span><span class="nb">second</span> <span class="nv">b-dims</span><span class="p">)</span>
                     <span class="nb">do</span> <span class="p">(</span><span class="nb">loop</span> <span class="nv">for</span> <span class="nv">k</span> <span class="nv">from</span> <span class="mi">0</span> <span class="nv">below</span> <span class="p">(</span><span class="nb">second</span> <span class="nv">a-dims</span><span class="p">)</span>
                              <span class="nb">do</span> <span class="p">(</span><span class="nb">incf</span> <span class="p">(</span><span class="nv">tensor-ref</span> <span class="nv">result</span> <span class="nv">i</span> <span class="nv">j</span><span class="p">)</span>
                                     <span class="p">(</span><span class="nb">*</span> <span class="p">(</span><span class="nv">tensor-ref</span> <span class="nv">a</span> <span class="nv">i</span> <span class="nv">k</span><span class="p">)</span>
                                        <span class="p">(</span><span class="nv">tensor-ref</span> <span class="nv">b</span> <span class="nv">k</span> <span class="nv">j</span><span class="p">))))))</span>
      <span class="nv">result</span><span class="p">)))</span>

<span class="c1">;; Example usage</span>
<span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">matrix-a</span> <span class="p">(</span><span class="nv">make-tensor</span> <span class="o">'</span><span class="p">(</span><span class="mi">3</span> <span class="mi">4</span><span class="p">)))</span>
      <span class="p">(</span><span class="nv">matrix-b</span> <span class="p">(</span><span class="nv">make-tensor</span> <span class="o">'</span><span class="p">(</span><span class="mi">4</span> <span class="mi">2</span><span class="p">))))</span>
  <span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">"Created matrices: ~A x ~A~%"</span> 
          <span class="p">(</span><span class="nv">tensor-dimensions</span> <span class="nv">matrix-a</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">tensor-dimensions</span> <span class="nv">matrix-b</span><span class="p">))</span>
  <span class="p">(</span><span class="nv">matrix-multiply</span> <span class="nv">matrix-a</span> <span class="nv">matrix-b</span><span class="p">))</span>
</code></pre></div></div>

<h2 id="lua-example">Lua Example</h2>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- Tensor library for scientific computing</span>
<span class="kd">local</span> <span class="n">Tensor</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">Tensor</span><span class="p">.</span><span class="n">__index</span> <span class="o">=</span> <span class="n">Tensor</span>

<span class="k">function</span> <span class="nf">Tensor</span><span class="p">:</span><span class="n">new</span><span class="p">(</span><span class="n">dimensions</span><span class="p">,</span> <span class="n">backend</span><span class="p">)</span>
    <span class="kd">local</span> <span class="n">obj</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">dimensions</span> <span class="o">=</span> <span class="n">dimensions</span> <span class="ow">or</span> <span class="p">{},</span>
        <span class="n">backend</span> <span class="o">=</span> <span class="n">backend</span> <span class="ow">or</span> <span class="s2">"cpu"</span><span class="p">,</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="p">}</span>
    
    <span class="c1">-- Calculate total size</span>
    <span class="kd">local</span> <span class="n">total_size</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">dim</span> <span class="k">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">dimensions</span><span class="p">)</span> <span class="k">do</span>
        <span class="n">total_size</span> <span class="o">=</span> <span class="n">total_size</span> <span class="o">*</span> <span class="n">dim</span>
    <span class="k">end</span>
    
    <span class="c1">-- Initialize data</span>
    <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">total_size</span> <span class="k">do</span>
        <span class="n">obj</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span>
    <span class="k">end</span>
    
    <span class="nb">setmetatable</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">self</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">obj</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nf">Tensor</span><span class="p">:</span><span class="n">size</span><span class="p">()</span>
    <span class="k">return</span> <span class="o">#</span><span class="n">self</span><span class="p">.</span><span class="n">data</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nf">Tensor</span><span class="p">:</span><span class="n">reshape</span><span class="p">(</span><span class="n">new_dimensions</span><span class="p">)</span>
    <span class="kd">local</span> <span class="n">total_size</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">dim</span> <span class="k">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">new_dimensions</span><span class="p">)</span> <span class="k">do</span>
        <span class="n">total_size</span> <span class="o">=</span> <span class="n">total_size</span> <span class="o">*</span> <span class="n">dim</span>
    <span class="k">end</span>
    
    <span class="nb">assert</span><span class="p">(</span><span class="n">total_size</span> <span class="o">==</span> <span class="o">#</span><span class="n">self</span><span class="p">.</span><span class="n">data</span><span class="p">,</span> <span class="s2">"Cannot reshape: size mismatch"</span><span class="p">)</span>
    <span class="n">self</span><span class="p">.</span><span class="n">dimensions</span> <span class="o">=</span> <span class="n">new_dimensions</span>
    <span class="k">return</span> <span class="n">self</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nf">Tensor</span><span class="p">:</span><span class="n">get</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
    <span class="kd">local</span> <span class="n">indices</span> <span class="o">=</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>
    <span class="kd">local</span> <span class="n">flat_index</span> <span class="o">=</span> <span class="n">self</span><span class="p">:</span><span class="n">_compute_flat_index</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="n">flat_index</span><span class="p">]</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nf">Tensor</span><span class="p">:</span><span class="n">set</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
    <span class="kd">local</span> <span class="n">indices</span> <span class="o">=</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>
    <span class="kd">local</span> <span class="n">flat_index</span> <span class="o">=</span> <span class="n">self</span><span class="p">:</span><span class="n">_compute_flat_index</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span>
    <span class="n">self</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="n">flat_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nf">Tensor</span><span class="p">:</span><span class="n">_compute_flat_index</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span>
    <span class="kd">local</span> <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="kd">local</span> <span class="n">multiplier</span> <span class="o">=</span> <span class="mi">1</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="o">#</span><span class="n">indices</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span> <span class="k">do</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">index</span> <span class="o">+</span> <span class="p">(</span><span class="n">indices</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">multiplier</span>
        <span class="n">multiplier</span> <span class="o">=</span> <span class="n">multiplier</span> <span class="o">*</span> <span class="n">self</span><span class="p">.</span><span class="n">dimensions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="k">end</span>
    
    <span class="k">return</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1">-- Lua uses 1-based indexing</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nf">Tensor</span><span class="p">:</span><span class="n">apply</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="o">#</span><span class="n">self</span><span class="p">.</span><span class="n">data</span> <span class="k">do</span>
        <span class="n">self</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="k">end</span>
    <span class="k">return</span> <span class="n">self</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nf">Tensor</span><span class="p">:</span><span class="n">__tostring</span><span class="p">()</span>
    <span class="k">return</span> <span class="nb">string.format</span><span class="p">(</span><span class="s2">"Tensor%s [%s backend]"</span><span class="p">,</span> 
                        <span class="nb">table.concat</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">dimensions</span><span class="p">,</span> <span class="s2">"x"</span><span class="p">),</span> 
                        <span class="n">self</span><span class="p">.</span><span class="n">backend</span><span class="p">)</span>
<span class="k">end</span>

<span class="c1">-- Example usage</span>
<span class="kd">local</span> <span class="k">function</span> <span class="nf">main</span><span class="p">()</span>
    <span class="kd">local</span> <span class="n">tensor</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">:</span><span class="n">new</span><span class="p">({</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">},</span> <span class="s2">"metal"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"Created:"</span><span class="p">,</span> <span class="n">tensor</span><span class="p">)</span>
    
    <span class="c1">-- Fill with some values</span>
    <span class="kd">local</span> <span class="n">value</span> <span class="o">=</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">tensor</span><span class="p">:</span><span class="n">size</span><span class="p">()</span> <span class="k">do</span>
        <span class="n">tensor</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">value</span> <span class="o">+</span> <span class="mi">0</span><span class="p">.</span><span class="mi">1</span>
    <span class="k">end</span>
    
    <span class="c1">-- Apply a function</span>
    <span class="n">tensor</span><span class="p">:</span><span class="n">apply</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">return</span> <span class="nb">math.sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">end</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">"Applied sine function to all elements"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"Element at (1,1,1):"</span><span class="p">,</span> <span class="n">tensor</span><span class="p">:</span><span class="n">get</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="k">end</span>

<span class="n">main</span><span class="p">()</span>
</code></pre></div></div>

<p>This demonstrates the new modern syntax highlighting with copy buttons, line numbers, and clean styling for all your preferred languages!</p>

  </div><a class="u-url" href="/testing/2025/01/21/testing-new-syntax-highlighting.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Robbie&#39;s Blog - Review Site</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Robbie&#39;s Blog - Review Site</li><li><a class="u-email" href="mailto:rob.alexander.115@gmail.com">rob.alexander.115@gmail.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/Rob-Alex"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">Rob-Alex</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Review and staging environment for blog posts and features.</p>
      </div>
    </div>

  </div>

</footer>

<!-- KaTeX Auto-render Initialization with Equation Numbering -->
<script>
document.addEventListener("DOMContentLoaded", function() {
  // Pre-process equation references before KaTeX renders
  processEquationReferences();
  
  // Render math with KaTeX
  renderMathInElement(document.body, {
    delimiters: [
      {left: '$$', right: '$$', display: true},
      {left: '$', right: '$', display: false},
      {left: '\\(', right: '\\)', display: false},
      {left: '\\[', right: '\\]', display: true}
    ],
    throwOnError: false
  });
  
  // Add equation numbers after KaTeX renders
  setTimeout(function() {
    numberEquations();
    linkEquationReferences();
  }, 100);
});

function processEquationReferences() {
  // Convert \eqref and \ref to temporary placeholders before KaTeX processing
  const walker = document.createTreeWalker(
    document.body,
    NodeFilter.SHOW_TEXT,
    null,
    false
  );
  
  const textNodes = [];
  let node;
  while (node = walker.nextNode()) {
    if (node.textContent.includes('\\eqref') || node.textContent.includes('\\ref')) {
      textNodes.push(node);
    }
  }
  
  textNodes.forEach(function(textNode) {
    let content = textNode.textContent;
    content = content.replace(/\\eqref\{([^}]+)\}/g, '<span class="eq-ref-placeholder" data-ref="$1" data-type="eqref"></span>');
    content = content.replace(/\\ref\{([^}]+)\}/g, '<span class="eq-ref-placeholder" data-ref="$1" data-type="ref"></span>');
    
    if (content !== textNode.textContent) {
      const wrapper = document.createElement('span');
      wrapper.innerHTML = content;
      textNode.parentNode.replaceChild(wrapper, textNode);
    }
  });
}

function numberEquations() {
  let equationNumber = 1;
  const equationMap = new Map();
  
  // Find all display math elements
  const displayMath = document.querySelectorAll('.katex-display');
  
  displayMath.forEach(function(mathElement) {
    // Get the original LaTeX source from the script tag
    const scriptTag = mathElement.previousElementSibling;
    let mathContent = '';
    
    if (scriptTag && scriptTag.tagName === 'SCRIPT' && scriptTag.type === 'math/tex; mode=display') {
      mathContent = scriptTag.textContent;
    } else {
      mathContent = mathElement.textContent || mathElement.innerText;
    }
    
    // Check if it should be numbered (not \begin{equation*} or similar unnumbered)
    if ((mathContent.includes('\\begin{equation}') || 
         mathContent.includes('\\begin{align}') ||
         mathContent.trim().startsWith('\\[')) &&
        !mathContent.includes('\\begin{equation*}') &&
        !mathContent.includes('\\begin{align*}')) {
      
      // Create equation number element
      const numberSpan = document.createElement('span');
      numberSpan.className = 'equation-number';
      numberSpan.textContent = `(${equationNumber})`;
      
      // Position the number
      mathElement.style.position = 'relative';
      mathElement.appendChild(numberSpan);
      
      // Extract label if present
      const labelMatch = mathContent.match(/\\label\{([^}]+)\}/);
      if (labelMatch) {
        const label = labelMatch[1];
        mathElement.setAttribute('data-label', label);
        mathElement.id = `eq:${label}`;
        equationMap.set(label, equationNumber);
      } else {
        mathElement.id = `eq:${equationNumber}`;
      }
      
      equationNumber++;
    }
  });
  
  // Store equation map globally for reference linking
  window.equationMap = equationMap;
}

function linkEquationReferences() {
  // Replace placeholders with actual links
  const placeholders = document.querySelectorAll('.eq-ref-placeholder');
  
  placeholders.forEach(function(placeholder) {
    const ref = placeholder.getAttribute('data-ref');
    const type = placeholder.getAttribute('data-type');
    
    const link = document.createElement('a');
    link.href = `#eq:${ref}`;
    link.className = 'eqref';
    
    if (type === 'eqref') {
      // Find the equation number for this reference
      const equationNumber = window.equationMap ? window.equationMap.get(ref) : ref;
      link.textContent = `(${equationNumber || ref})`;
    } else {
      link.textContent = ref;
    }
    
    placeholder.parentNode.replaceChild(link, placeholder);
  });
}
</script>

<!-- Reading Progress & Modern Enhancements -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Reading progress indicator
  const progressBar = document.createElement('div');
  progressBar.id = 'reading-progress';
  progressBar.style.cssText = `
    position: fixed;
    top: 0;
    left: 0;
    width: 0%;
    height: 3px;
    background: linear-gradient(90deg, var(--link-color), var(--link-hover));
    z-index: 1000;
    transition: width 0.1s ease;
    border-radius: 0 3px 3px 0;
  `;
  document.body.appendChild(progressBar);
  
  // Update progress on scroll
  function updateReadingProgress() {
    const scrollTop = window.pageYOffset;
    const docHeight = document.documentElement.scrollHeight - window.innerHeight;
    const scrollPercent = (scrollTop / docHeight) * 100;
    progressBar.style.width = scrollPercent + '%';
  }
  
  window.addEventListener('scroll', updateReadingProgress);
  
  // Add reading time estimate
  addReadingTime();
});

function addReadingTime() {
  const content = document.querySelector('.page-content');
  if (!content) return;
  
  const text = content.innerText || content.textContent;
  const wordsPerMinute = 200;
  const words = text.trim().split(/\s+/).length;
  const readingTime = Math.ceil(words / wordsPerMinute);
  
  // Find the post header area
  const postHeader = document.querySelector('.post-header') || 
                     document.querySelector('h1') || 
                     content.querySelector('h1');
  
  if (postHeader) {
    const readingIndicator = document.createElement('div');
    readingIndicator.style.cssText = `
      color: var(--text-secondary);
      font-size: 0.9rem;
      margin-top: 0.5rem;
      font-style: italic;
    `;
    readingIndicator.textContent = `${readingTime} min read • ${words} words`;
    
    postHeader.parentNode.insertBefore(readingIndicator, postHeader.nextSibling);
  }
}
</script>

<!-- Modern Code Block Enhancement -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Initialize highlight.js
  hljs.highlightAll();
  
  // Add copy buttons, line numbers, and collapsible functionality to all code blocks
  const codeBlocks = document.querySelectorAll('pre code');
  
  codeBlocks.forEach(function(codeBlock, index) {
    const pre = codeBlock.parentElement;
    
    // Wrap in container for styling
    if (!pre.parentElement.classList.contains('code-container')) {
      const container = document.createElement('div');
      container.className = 'code-container';
      pre.parentElement.insertBefore(container, pre);
      container.appendChild(pre);
    }
    
    // Check if code block is long enough to be collapsible (>15 lines)
    const lines = codeBlock.textContent.split('\n').length;
    const isLongCode = lines > 15;
    
    // Add copy button
    if (!pre.querySelector('.copy-button')) {
      const copyButton = document.createElement('button');
      copyButton.className = 'copy-button';
      copyButton.innerHTML = 'Copy';
      copyButton.title = 'Copy code';
      
      copyButton.addEventListener('click', function() {
        navigator.clipboard.writeText(codeBlock.textContent).then(function() {
          copyButton.innerHTML = 'Copied';
          copyButton.title = 'Copied!';
          setTimeout(function() {
            copyButton.innerHTML = 'Copy';
            copyButton.title = 'Copy code';
          }, 2000);
        });
      });
      
      pre.appendChild(copyButton);
    }
    
    // Add collapse functionality for long code blocks
    if (isLongCode && !pre.querySelector('.collapse-button')) {
      const collapseButton = document.createElement('button');
      collapseButton.className = 'collapse-button';
      collapseButton.innerHTML = 'Collapse';
      collapseButton.title = 'Collapse code';
      
      // Initially collapsed for very long code
      if (lines > 25) {
        pre.classList.add('collapsed');
        collapseButton.innerHTML = 'Expand';
        collapseButton.title = 'Expand code';
      }
      
      collapseButton.addEventListener('click', function() {
        pre.classList.toggle('collapsed');
        if (pre.classList.contains('collapsed')) {
          collapseButton.innerHTML = 'Expand';
          collapseButton.title = 'Expand code';
        } else {
          collapseButton.innerHTML = 'Collapse';
          collapseButton.title = 'Collapse code';
        }
      });
      
      pre.appendChild(collapseButton);
    }
    
    // Add line numbers
    if (!pre.classList.contains('has-line-numbers')) {
      const lines = codeBlock.textContent.split('\n');
      if (lines.length > 1) {
        const lineNumbers = document.createElement('div');
        lineNumbers.className = 'line-numbers';
        
        for (let i = 1; i <= lines.length - 1; i++) {
          const lineNumber = document.createElement('span');
          lineNumber.textContent = i;
          lineNumbers.appendChild(lineNumber);
        }
        
        pre.insertBefore(lineNumbers, codeBlock);
        pre.classList.add('has-line-numbers');
      }
    }
  });
});
</script>

<!-- Dark mode toggle script -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  const themeToggle = document.getElementById('theme-toggle');
  const themeIcon = document.querySelector('.theme-icon');
  const html = document.documentElement;
  
  // Get stored theme or detect system preference
  function getStoredTheme() {
    return localStorage.getItem('theme');
  }
  
  function getSystemTheme() {
    return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
  }
  
  function getCurrentTheme() {
    return getStoredTheme() || getSystemTheme();
  }
  
  // Apply theme
  function applyTheme(theme) {
    // Theme is already set in head, just update icon and storage
    if (themeIcon) {
      themeIcon.textContent = theme === 'dark' ? 'Light' : 'Dark';
    }
    localStorage.setItem('theme', theme);
    
    // Switch highlight.js themes
    const lightTheme = document.getElementById('highlight-light');
    const darkTheme = document.getElementById('highlight-dark');
    
    if (lightTheme && darkTheme) {
      if (theme === 'dark') {
        lightTheme.disabled = true;
        darkTheme.disabled = false;
      } else {
        lightTheme.disabled = false;
        darkTheme.disabled = true;
      }
    }
  }
  
  // Toggle theme
  function toggleTheme() {
    const currentTheme = html.getAttribute('data-theme') || getCurrentTheme();
    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
    html.setAttribute('data-theme', newTheme);
    applyTheme(newTheme);
  }
  
  // Initialize theme (data-theme already set in head, just update UI)
  const currentTheme = getCurrentTheme();
  applyTheme(currentTheme);
  
  // Add event listener
  if (themeToggle) {
    themeToggle.addEventListener('click', toggleTheme);
  }
  
  // Listen for system theme changes
  window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function(e) {
    if (!getStoredTheme()) {
      const newTheme = e.matches ? 'dark' : 'light';
      html.setAttribute('data-theme', newTheme);
      applyTheme(newTheme);
    }
  });
  
  // Simple search functionality
  function initializeSearch() {
    const searchToggle = document.getElementById('search-toggle');
    const searchInput = document.getElementById('search-input');
    const trigger = document.querySelector('.trigger');
    
    if (!searchToggle || !searchInput) return;
    
    // Toggle search input visibility
    searchToggle.addEventListener('click', function() {
      const isVisible = searchInput.style.display !== 'none';
      searchInput.style.display = isVisible ? 'none' : 'inline-block';
      if (!isVisible) {
        searchInput.focus();
      } else {
        hideSearchResults();
      }
    });
    
    // Hide search when clicking outside
    document.addEventListener('click', function(e) {
      if (!trigger.contains(e.target)) {
        searchInput.style.display = 'none';
        hideSearchResults();
      }
    });
    
    // Search functionality
    searchInput.addEventListener('input', function() {
      const query = this.value.trim();
      if (query.length < 2) {
        hideSearchResults();
        return;
      }
      performSearch(query);
    });
    
    function performSearch(query) {
      // Simple client-side search
      const results = [];
      const links = document.querySelectorAll('.site-nav .page-link, .post-link');
      
      links.forEach(function(link) {
        const title = link.textContent.toLowerCase();
        if (title.includes(query.toLowerCase())) {
          results.push({
            title: link.textContent,
            url: link.href,
            excerpt: 'Match found in: ' + title
          });
        }
      });
      
      showSearchResults(results);
    }
    
    function showSearchResults(results) {
      hideSearchResults();
      
      if (results.length === 0) {
        const resultsContainer = document.createElement('div');
        resultsContainer.className = 'search-results';
        resultsContainer.innerHTML = '<div class="search-result"><p>No results found</p></div>';
        trigger.style.position = 'relative';
        trigger.appendChild(resultsContainer);
        return;
      }
      
      const resultsContainer = document.createElement('div');
      resultsContainer.className = 'search-results';
      
      results.forEach(function(result) {
        const resultItem = document.createElement('a');
        resultItem.href = result.url;
        resultItem.className = 'search-result';
        resultItem.innerHTML = '<h4>' + result.title + '</h4><p>' + result.excerpt + '</p>';
        resultsContainer.appendChild(resultItem);
      });
      
      trigger.style.position = 'relative';
      trigger.appendChild(resultsContainer);
    }
    
    function hideSearchResults() {
      const existing = document.querySelector('.search-results');
      if (existing) {
        existing.remove();
      }
    }
  }
  
  // Initialize search when DOM is loaded
  initializeSearch();
});
</script>
</body>
</body>

</html>
